<html>

<head>
  <title>ELIMINAR IIO - PCP</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body>
  <h1>ELIMINAR IIO</h1>
  <p>Introduzca el ID de la IIO y presione <b>Eliminar</b></p>
  <input type="text" name="id" id="id" placeholder="ID">
  <button id="btnEliminar">Eliminar</button>
  <p id="status" class="oculto">Eliminando...</p>

  <script src="./javascripts/popper.min.js"></script>
  <script src="./javascripts/jquery-3.5.1.min.js"></script>
  <script src="./socket/socket.io.min.js"></script>
  <script>
  $(document).ready(()=>{
    socket = io(`http://pcp.sp3.gob.ve:3001`);
    socket.on("connect", ()=>{
        console.log("Conectados al Servidor Realtime...");
    });
  })

  $("#btnEliminar").on("click", ()=>{
    $("#status").show();
    $("#btnEliminar").prop("disabled", true);
    var idIIO = $("#id").val().trim();
    $.ajax({
        url: `./iio/${idIIO}`,
        type: "DELETE",
        success: function(resp){
            if(!resp.error){
                if(resp.data.n === 0){
                    alert("El IIO con el ID " + idIIO + " no existe.");
                    $("#btnEliminar").prop("disabled", false);
                    $("#status").hide();
                    
                }else{
                    alert("IIO " + idIIO + "Eliminada con Ã©xito");
                    $("#btnEliminar").prop("disabled", false);
                    $("#status").hide();
                    socket.emit("delete_iio", idIIO);
                }
            }else{
                alert("Error al intentar eliminar la IIO");
                $("#btnEliminar").prop("disabled", false);
                $("#status").hide();
            }
        },
        error: function(err){
            alert("Error al intentar eliminar la IIO");
            $("#btnEliminar").prop("disabled", false);
            $("#status").hide();
        }
    });
  })
  </script>
</body>
</html>
